#include "findpeaks.h"


/**
 * @brief Calculer le seuil initial basé sur la moyenne ou la médiane des amplitudes du signal.
 *
 * @param Yin Tableau d'entrée représentant le signal.
 * @return Seuil initial.
 */

float calculateInitialThreshold(float *Yin)
{
    // Vous pouvez choisir d'utiliser la moyenne ou la médiane ici
    // Exemple avec la moyenne :
    float sum = 0.0;
    int i;

    for (i = 0; i < LENGTHYIN; i++)
    {
        sum += Yin[i];
    }
    return sum / LENGTHYIN;
}



/**
 * @brief Met à jour le seuil dynamique en fonction de la moyenne mobile des amplitudes des pics.
 *
 * @param recentAmplitude Amplitude du pic le plus récent.
 * @param dynamicThreshold ancien threshold.
 * return la moyenne mobile
 */
float updateExpMovingAverage(float recentAmplitude, float dynamicThreshold)
{
    // Mettre à jour le seuil dynamique avec la moyenne mobile
    return ALPHA * recentAmplitude + (1 - ALPHA) * dynamicThreshold;
}




/**
 * @brief Trouve les pics dans un signal donné. Alloue et rempli iPk
 *
 * @param Yin Tableau d'entrée représentant le signal.
 * @param iPk Tableau de sortie pour stocker les indices des pics.
 * @return le nombre de pics trouvés
 */
int findpeaks(float *Yin, int **iPk)
{
    // Paramètres
    float MinPeakHeight = 1.0;
    int *tempArray = NULL;
    int nbPeaks;
    int i,j = 0;

    // Allouer dynamiquement de la mémoire pour un tableau temporaire
    if((tempArray = (int *)malloc(LENGTHYIN * sizeof(int))) == NULL)
    {
        return -1;
    }

    // On rempli iPk de -1 car -1 correspond au valeurs d'erreur (pas de pic)
    for (i = 0; i < LENGTHYIN; i++)
    {
        tempArray[i] = -1;
    }

    // Trouver les pics
    getAllPeaks(Yin, tempArray);

    // Supprimer les pics en dessous de MinPeakHeight
    removePeaksBelowMinPeakHeight(Yin, tempArray, MinPeakHeight);

    // Supprimer les pics en dessus du threshold dynamic
    nbPeaks = removePeaksBelowThreshold(Yin, tempArray);

    // Allouer dynamiquement de la mémoire pour notre tableau final
    if((*iPk = (int *)malloc(nbPeaks * sizeof(int))) == NULL)
    {
        return -1;
    }

    for(i = 0; i < LENGTHYIN; i++)
    {
        if(tempArray[i] > 0)
        {
            (*iPk)[j] = tempArray[i];
            j++;
        }
    }

    free(tempArray);

    return nbPeaks;
}



/**
 * @brief Trouve tous les pics dans un signal donné.
 *
 * @param Yin Tableau d'entrée représentant le signal.
 * @param iPk Tableau pour stocker les indices des pics.
 * @return le nombres de pics trouvés au total
 */
int getAllPeaks(float *Yin, int *iPk)
{
    // A voir si on veut faire d'autres traitements ici

    // On récupère les maximum locaux et les points d'inflexion
    return findLocalMaxima(Yin, iPk);
}



/**
 * @brief Supprime les pics en dessous d'une certaine hauteur minimale.
 *
 * @param Yin Tableau d'entrée représentant le signal.
 * @param iPk Tableau des indices des pics à modifier.
 * @param MinPeakHeight Hauteur minimale requise pour conserver un pic.
 * @return le nombres de pics restant après traitement
 */
int removePeaksBelowMinPeakHeight(float *Yin, int *iPk, float MinPeakHeight) 
{
    int cpt = 0; // Compteur de pics après traitement

    for (int i = 0; i < LENGTHYIN; i++)
    {
        // Si on a un pic
        if(iPk[i] > 0)
        {
            // Si ce pic est inférieur à la valeur min souhaitée pour un pic
            if (Yin[iPk[i]] < MinPeakHeight)
            {
                iPk[i] = -1; // -1 pour dire que ce n'est pas un pic
            }
            else
            {
                cpt++;
            }
        }      
    }

    return cpt;
}


/**
 * @brief Supprime les indices des pics dont la valeur dans le signal est en dessous d'un certain seuil par rapport à leurs voisins immédiats
 *
 * @param Yin Tableau d'entrée représentant le signal.
 * @param iPk Tableau des indices des pics.
 * @return le nombres de pics restant après traitement
 */
int removePeaksBelowThreshold(float *Yin, int *iPk)
{
    float dynamicThreshold = calculateInitialThreshold(Yin);
    int cpt = 0; // Compteur de pics après traitement

    // Parcourir tous les indices dans iPk
    for (int i = 0; i < LENGTHYIN; i++)
    {
        // Si c'est un pic
        if(iPk[i] > 0)
        {
            // Calculer l'indice précédent et suivant dans Yin
            int prevIndex = iPk[i] - 2;
            int nextIndex = iPk[i] + 2;

             // Mettre à jour le seuil dynamique avec la moyenne mobile
            dynamicThreshold = updateExpMovingAverage(Yin[i], dynamicThreshold);

            // Vérifier les limites du tableau d'entrée
            if(prevIndex >= 0 && nextIndex < LENGTHYIN)
            {
                // Calculer la valeur maximale entre les voisins immédiats
                float base = (Yin[prevIndex] > Yin[nextIndex]) ? Yin[prevIndex] : Yin[nextIndex];

                // Vérifier la condition de seuil
                if (Yin[iPk[i]] - base < dynamicThreshold)
                {
                    // Si la condition n'est pas satisfaite, -1 pour dire que ce n'est pas un pic
                    iPk[i] = -1;
                }
                else
                {
                    cpt++;
                }
            }
            else
            {
                iPk[i] = -1;
            }
        }
    }

    return cpt;
}


/**
 * @brief Trouve les pics locaux et les points d'inflection dans un signal.
 *
 * @param Yin Tableau d'entrée représentant le signal.
 * @param iPk Tableau de sortie pour stocker les indices des pics locaux.
 * @return le nombres de pics trouvés
 */
int findLocalMaxima(float *Yin, int *iPk)
{
    // Réalise la fonction sign et stock les coefficients 1 -1 et 0
    int s[LENGTHYIN - 1];
    for (int i = 0; i < LENGTHYIN - 1; i++)
    {
        s[i] = (Yin[i + 1] - Yin[i] > 0) ? 1 : ((Yin[i + 1] - Yin[i] < 0) ? -1 : 0);
    }

    // Trouver un maximum local ou un point d'inflection
    int maxCount = 0; // Compteur de pics
    for (int i = 0; i < LENGTHYIN - 2; i++)
    {
        if (s[i] > s[i + 1] || s[i] != s[i + 1]) // max local || point d'inflexion
        {
            iPk[maxCount] = i+1;
            maxCount++;
        }
    }


    return maxCount;
}


/* EXEMPLE TEST */
/*
int main()
{
    int *iPk = NULL;
    int nbPeaks;
    int i,j = 0;

    float Yin[] = {0.065, 0.195, 0.675, 1.083, 1.142, 2.308, 2.702, 2.332, 1.276, 1.094, 2.360, 5.336, 3.816, 2.320, 9.378, 8.140, 2.634, 2.846, 2.167, 1.357, 1.072, 2.608, 3.665, 1.853, 1.245, 0.911, 0.931, 0.900, 2.222, 2.791, 1.172, 0.956, 0.640, 0.831, 0.983, 1.125, 1.962, 1.158, 0.889, 0.849, 0.678, 0.848, 0.985, 1.503, 1.194, 0.592, 0.528, 0.500, 0.404, 0.653, 0.720, 0.587, 0.525, 0.409, 0.406, 0.333, 0.411, 0.720, 0.818, 0.456, 0.314, 0.365, 0.507, 0.433, 0.276, 0.471, 0.700, 0.626, 0.570, 0.449, 0.579, 0.513, 0.539, 0.512, 0.416, 0.431, 0.529, 0.473, 0.386, 0.402, 0.526, 0.416, 0.552, 0.388, 0.538, 0.533, 0.340, 0.438, 0.407, 0.366, 0.420, 0.390, 0.335, 0.383, 0.471, 0.263, 0.282, 0.346, 0.307, 0.432, 0.422, 0.336, 0.349, 0.310, 0.398, 0.308, 0.363, 0.380, 0.482, 0.517, 0.454, 0.317, 0.303, 0.269, 0.284, 0.309, 0.369, 0.384, 0.278, 0.324, 0.385, 0.341, 0.338, 0.282, 0.243, 0.317, 0.316, 0.281, 0.220, 0.192, 0.152, 0.208, 0.258, 0.216, 0.163, 0.190, 0.160, 0.162, 0.156, 0.114, 0.162, 0.213, 0.229, 0.156, 0.259, 0.280, 0.225, 0.183, 0.148, 0.133, 0.149, 0.174, 0.121, 0.138, 0.185, 0.166, 0.132, 0.160, 0.189, 0.144, 0.128, 0.145, 0.177, 0.187, 0.225, 0.235, 0.204, 0.194, 0.138, 0.178, 0.258, 0.252, 0.242, 0.169, 0.121, 0.176, 0.197, 0.197, 0.177, 0.181, 0.171, 0.178, 0.177, 0.155, 0.136, 0.204, 0.221, 0.155, 0.172, 0.176, 0.164, 0.127, 0.104, 0.229, 0.139, 0.172, 0.257, 0.222, 0.242, 0.245, 0.174, 0.163, 0.157, 0.151, 0.157, 0.131, 0.194, 0.230, 0.174, 0.210, 0.195, 0.213, 0.169, 0.207, 0.199, 0.181, 0.136, 0.146, 0.185, 0.157, 0.095, 0.109, 0.132, 0.133, 0.096, 0.146, 0.158, 0.162, 0.133, 0.107, 0.100, 0.095, 0.105, 0.163, 0.151, 0.152, 0.140, 0.096, 0.119, 0.087, 0.091, 0.102, 0.111, 0.104, 0.117, 0.079, 0.088, 0.087, 0.089, 0.117, 0.134, 0.096, 0.118, 0.111, 0.124, 0.091, 0.082, 0.083, 0.079, 0.094, 0.126, 0.097, 0.078, 0.088, 0.084, 0.087, 0.082, 0.080, 0.079, 0.062, 0.052, 0.074, 0.078, 0.069, 0.064, 0.063, 0.056, 0.056, 0.073, 0.073, 0.052, 0.059, 0.040, 0.027, 0.039, 0.044, 0.042, 0.042, 0.041, 0.025, 0.024, 0.021, 0.016, 0.015, 0.012, 0.015, 0.020, 0.021, 0.017, 0.016, 0.013, 0.012, 0.009, 0.008, 0.010, 0.007, 0.005, 0.003, 0.003, 0.003, 0.002, 0.002, 0.001, 0.000, 0.000, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.001, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.001, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.000, 0.000, 0.001, 0.002, 0.002, 0.003, 0.003, 0.003, 0.005, 0.007, 0.010, 0.008, 0.009, 0.012, 0.013, 0.016, 0.017, 0.021, 0.020, 0.015, 0.012, 0.015, 0.016, 0.021, 0.024, 0.025, 0.041, 0.042, 0.042, 0.044, 0.039, 0.027, 0.040, 0.059, 0.052, 0.073, 0.073, 0.056, 0.056, 0.063, 0.064, 0.069, 0.078, 0.074, 0.052, 0.062, 0.079, 0.080, 0.082, 0.087, 0.084, 0.088, 0.078, 0.097, 0.126, 0.094, 0.079, 0.083, 0.082, 0.091, 0.124, 0.111, 0.118, 0.096, 0.134, 0.117, 0.089, 0.087, 0.088, 0.079, 0.117, 0.104, 0.111, 0.102, 0.091, 0.087, 0.119, 0.096, 0.140, 0.152, 0.151, 0.163, 0.105, 0.095, 0.100, 0.107, 0.133, 0.162, 0.158, 0.146, 0.096, 0.133, 0.132, 0.109, 0.095, 0.157, 0.185, 0.146, 0.136, 0.181, 0.199, 0.207, 0.169, 0.213, 0.195, 0.210, 0.174, 0.230, 0.194, 0.131, 0.157, 0.151, 0.157, 0.163, 0.174, 0.245, 0.242, 0.222, 0.257, 0.172, 0.139, 0.229, 0.104, 0.127, 0.164, 0.176, 0.172, 0.155, 0.221, 0.204, 0.136, 0.155, 0.177, 0.178, 0.171, 0.181, 0.177, 0.197, 0.197, 0.176, 0.121, 0.169, 0.242, 0.252, 0.258, 0.178, 0.138, 0.194, 0.204, 0.235, 0.225, 0.187, 0.177, 0.145, 0.128, 0.144, 0.189, 0.160, 0.132, 0.166, 0.185, 0.138, 0.121, 0.174, 0.149, 0.133, 0.148, 0.183, 0.225, 0.280, 0.259, 0.156, 0.229, 0.213, 0.162, 0.114, 0.156, 0.162, 0.160, 0.190, 0.163, 0.216, 0.258, 0.208, 0.152, 0.192, 0.220, 0.281, 0.316, 0.317, 0.243, 0.282, 0.338, 0.341, 0.385, 0.324, 0.278, 0.384, 0.369, 0.309, 0.284, 0.269, 0.303, 0.317, 0.454, 0.517, 0.482, 0.380, 0.363, 0.308, 0.398, 0.310, 0.349, 0.336, 0.422, 0.432, 0.307, 0.346, 0.282, 0.263, 0.471, 0.383, 0.335, 0.390, 0.420, 0.366, 0.407, 0.438, 0.340, 0.533, 0.538, 0.388, 0.552, 0.416, 0.526, 0.402, 0.386, 0.473, 0.529, 0.431, 0.416, 0.512, 0.539, 0.513, 0.579, 0.449, 0.570, 0.626, 0.700, 0.471, 0.276, 0.433, 0.507, 0.365, 0.314, 0.456, 0.818, 0.720, 0.411, 0.333, 0.406, 0.409, 0.525, 0.587, 0.720, 0.653, 0.404, 0.500, 0.528, 0.592, 1.194, 1.503, 0.985, 0.848, 0.678, 0.849, 0.889, 1.158, 1.962, 1.125, 0.983, 0.831, 0.640, 0.956, 1.172, 2.791, 2.222, 0.900, 0.931, 0.911, 1.245, 1.853, 3.665, 2.608, 1.072, 1.357, 2.167, 2.846, 2.634, 8.140, 9.378, 2.320, 3.816, 5.336, 2.360, 1.094, 1.276, 2.332, 2.702, 2.308, 1.142, 1.083, 0.675, 0.195};

    if((nbPeaks = findpeaks(Yin,&iPk)) > 0)
    {       
        printf("NB PEAKS: %d\n", nbPeaks);
         
        for(i=0; i < nbPeaks; i++)
        {
            j++;
            printf("Amplitude %d : %f Indice : %d\n", j, Yin[iPk[i]], iPk[i]);
        }

    }
    else
    {
        printf("Pas de pics\n");
    }


    free(iPk);
    system("pause");

    return 0;
}
*/
